import{j as e,c as B,P as G,u as z,l as S,B as u,s as k}from"./TournamentApp.DgPOkh2S.js";import{r as y}from"./index.DXA_EoSs.js";import{g as F,v as H,c as E}from"./factory.DvPW-T9g.js";function h({className:l,type:x,...m}){return e.jsx("input",{type:x,"data-slot":"input",className:B("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",l),...m})}var J="Label",R=y.forwardRef((l,x)=>e.jsx(G.label,{...l,ref:x,onMouseDown:m=>{m.target.closest("button, input, select, textarea")||(l.onMouseDown?.(m),!m.defaultPrevented&&m.detail>1&&m.preventDefault())}}));R.displayName=J;var U=R;function c({className:l,...x}){return e.jsx(U,{"data-slot":"label",className:B("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",l),...x})}function V({editingTournamentId:l,initialStep:x,onTournamentCreated:m,onCancel:w}){const{t:s}=z(),[j,b]=y.useState(x||"type"),[d,C]=y.useState(null),[a,r]=y.useState(F("single-elimination")),[N,M]=y.useState(""),[P,p]=y.useState([]),f=!!l;y.useEffect(()=>{if(f&&l){const t=S(l);t&&(C(t.type),r(t.options))}},[f,l]);const L=t=>{C(t),r(F(t)),b("options")},D=()=>{b("participants")},T=()=>{if(!N.trim())return;const t=a.participantNames||[],n=N.trim();if(t.some(i=>i.toLowerCase()===n.toLowerCase())){p([s("create.duplicateNameError")]);return}p([]),r({...a,participantNames:[...t,n]}),M("")},W=t=>{const n=a.participantNames||[];r({...a,participantNames:n.filter((i,o)=>o!==t)}),p([])},A=()=>{const t=H(a);if(t.length>0){p(t);return}try{if(f&&l){const n=S(l);if(!n){p([s("create.tournamentNotFound")]);return}if(I(n)){const o=$(n.options,a);if(o.length>0){p([s("create.cannotEditStructuralOptions"),s("create.structuralChangesDetected",{changes:o.join(", ")}),s("create.matchesAlreadyCompleted")]);return}const g={...n,options:a,updatedAt:new Date().toISOString()};k(g),m(l)}else{const o=E({...a,type:n.type});o.id=n.id,o.createdAt=new Date(n.createdAt),o.start();const g=o.export();k(g),m(l)}}else{const n=E(a);n.start();const i=n.export();k(i),m(n.getId())}}catch(n){p([n instanceof Error?n.message:s("create.createError")])}},I=t=>{switch(t.type){case"single-elimination":return t.bracket.some(n=>n.status==="completed");case"double-elimination":return t.winnersBracket.some(n=>n.status==="completed")||t.losersBracket.some(n=>n.status==="completed");case"round-robin":return t.matches.some(n=>n.status==="completed");case"swiss":return t.rounds.some(n=>n.some(i=>i.status==="completed"));case"free-for-all":return t.rounds.some(n=>n.some(i=>i.status==="completed"));default:return!1}},$=(t,n)=>{const i=[];return JSON.stringify(t.participantNames)!==JSON.stringify(n.participantNames)&&i.push(s("create.participantList")),t.matchType!==n.matchType&&i.push(s("create.matchType")),t.playersPerMatch!==n.playersPerMatch&&i.push(s("create.playersPerMatch")),t.type==="single-elimination"&&n.type==="single-elimination"&&t.thirdPlaceMatch!==n.thirdPlaceMatch&&i.push(s("create.thirdPlaceMatch")),t.type==="double-elimination"&&n.type==="double-elimination"&&t.splitStart!==n.splitStart&&i.push(s("create.splitStart")),t.type==="round-robin"&&n.type==="round-robin"&&t.rounds!==n.rounds&&i.push(s("create.numberOfRounds")),t.type==="free-for-all"&&n.type==="free-for-all"&&t.participantsPerMatch!==n.participantsPerMatch&&i.push(s("create.participantsPerMatch")),i},K=[{type:"single-elimination",label:s("tournamentTypes.singleElimination"),description:s("tournamentTypeDescriptions.singleElimination")},{type:"double-elimination",label:s("tournamentTypes.doubleElimination"),description:s("tournamentTypeDescriptions.doubleElimination")},{type:"round-robin",label:s("tournamentTypes.roundRobin"),description:s("tournamentTypeDescriptions.roundRobin")},{type:"swiss",label:s("tournamentTypes.swiss"),description:s("tournamentTypeDescriptions.swiss")},{type:"free-for-all",label:s("tournamentTypes.freeForAll"),description:s("tournamentTypeDescriptions.freeForAll")}];return e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 md:p-8",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s(f?"create.editTitle":"create.title")}),e.jsx(u,{variant:"ghost",size:"icon",onClick:w,title:s("common.cancel"),children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex items-center justify-between",children:[s("create.step.type"),s("create.step.options"),s("create.step.participants")].map((t,n)=>{const o=["type","options","participants"].indexOf(j),g=n===o,v=n<o;return e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full ${v||g?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"}`,children:v?"âœ“":n+1}),e.jsx("span",{className:`ml-2 text-sm font-medium ${g?"text-blue-600":v?"text-gray-900":"text-gray-500"}`,children:t})]}),n<2&&e.jsx("div",{className:`flex-1 h-0.5 mx-4 ${v?"bg-blue-600":"bg-gray-200"}`})]},t)})})}),P.length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800 mb-2",children:s("create.errorTitle")}),e.jsx("ul",{className:"list-disc list-inside text-sm text-red-700 space-y-1",children:P.map((t,n)=>e.jsx("li",{children:t},n))})]}),j==="type"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:s("create.selectType")}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:K.map(t=>e.jsx(u,{variant:"outline",onClick:()=>L(t.type),className:"h-auto text-left p-4 justify-start hover:border-blue-500 hover:bg-blue-50",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.label}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 font-normal",children:t.description})]})},t.type))})]}),j==="options"&&d&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:s("create.tournamentOptions")}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"tournament-name",children:s("create.tournamentName")}),e.jsx(h,{id:"tournament-name",type:"text",value:a.name||"",onChange:t=>r({...a,name:t.target.value}),placeholder:s("create.tournamentNamePlaceholder"),className:"mt-2"})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-4",children:s("options.matchType")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start",children:[e.jsx("input",{type:"radio",checked:(a.matchType||"head-to-head")==="head-to-head",onChange:()=>r({...a,matchType:"head-to-head",playersPerMatch:2,pointsSystem:void 0}),className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s("options.matchTypeHeadToHead")}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("options.tooltips.matchType")})]})]}),e.jsxs("label",{className:"flex items-start",children:[e.jsx("input",{type:"radio",checked:a.matchType==="multi-player",onChange:()=>r({...a,matchType:"multi-player",playersPerMatch:4}),className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s("options.matchTypeMultiPlayer")}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("options.tooltips.playersPerMatch")})]})]})]}),a.matchType==="multi-player"&&e.jsxs("div",{className:"mt-4",children:[e.jsx(c,{htmlFor:"players-per-match",children:s("options.playersPerMatch")}),e.jsxs("select",{id:"players-per-match",value:a.playersPerMatch||4,onChange:t=>r({...a,playersPerMatch:parseInt(t.target.value)}),className:"mt-2 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"3",children:"3"}),e.jsx("option",{value:"4",children:"4"}),e.jsx("option",{value:"5",children:"5"}),e.jsx("option",{value:"6",children:"6"}),e.jsx("option",{value:"8",children:"8"}),e.jsx("option",{value:"12",children:"12"})]})]}),a.matchType==="multi-player"&&(d==="round-robin"||d==="swiss"||d==="free-for-all")&&e.jsxs("div",{className:"mt-4",children:[e.jsx(c,{htmlFor:"points-system",children:s("options.pointsSystem")}),e.jsxs("select",{id:"points-system",value:a.pointsSystem?.type||"mario-kart",onChange:t=>{const n=t.target.value;r({...a,pointsSystem:{type:n}})},className:"mt-2 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"mario-kart",children:s("options.pointsSystemMarioKart")}),e.jsx("option",{value:"f1",children:s("options.pointsSystemF1")}),e.jsx("option",{value:"linear",children:s("options.pointsSystemLinear")}),e.jsx("option",{value:"winner-takes-most",children:s("options.pointsSystemWinnerTakesMost")})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:a.pointsSystem?.type&&s(`options.tooltips.pointsSystem${a.pointsSystem.type.split("-").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join("")}`)})]})]}),d==="single-elimination"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.thirdPlaceMatch||!1,onChange:t=>r({...a,thirdPlaceMatch:t.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:s("options.thirdPlaceMatch")})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.tieBreakers||!1,onChange:t=>r({...a,tieBreakers:t.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:s("options.tieBreakers")})]})]}),d==="double-elimination"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.splitStart||!1,onChange:t=>r({...a,splitStart:t.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:s("options.splitStart")})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.tieBreakers||!1,onChange:t=>r({...a,tieBreakers:t.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:s("options.tieBreakers")})]})]}),d==="round-robin"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("options.rankingMethod")}),e.jsxs("select",{value:a.rankingMethod||"wins",onChange:t=>r({...a,rankingMethod:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"wins",children:s("options.rankingWins")}),e.jsx("option",{value:"points",children:s("options.rankingPoints")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("options.numberOfRounds")}),e.jsxs("select",{value:a.rounds||1,onChange:t=>r({...a,rounds:parseInt(t.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"1",children:s("options.roundsOnce")}),e.jsx("option",{value:"2",children:s("options.roundsTwice")}),e.jsx("option",{value:"3",children:s("options.roundsThrice")})]})]})]}),d==="swiss"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"points-match-win",children:s("options.pointsPerMatchWin")}),e.jsx(h,{id:"points-match-win",type:"number",min:"0",value:a.pointsPerMatchWin||3,onChange:t=>r({...a,pointsPerMatchWin:parseInt(t.target.value)}),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"points-match-tie",children:s("options.pointsPerMatchTie")}),e.jsx(h,{id:"points-match-tie",type:"number",min:"0",value:a.pointsPerMatchTie||1,onChange:t=>r({...a,pointsPerMatchTie:parseInt(t.target.value)}),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"points-game-win",children:s("options.pointsPerGameWin")}),e.jsx(h,{id:"points-game-win",type:"number",min:"0",value:a.pointsPerGameWin||1,onChange:t=>r({...a,pointsPerGameWin:parseInt(t.target.value)}),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"points-bye",children:s("options.pointsPerBye")}),e.jsx(h,{id:"points-bye",type:"number",min:"0",value:a.pointsPerBye||3,onChange:t=>r({...a,pointsPerBye:parseInt(t.target.value)}),className:"mt-2"})]})]}),a.matchType==="multi-player"&&e.jsxs("div",{className:"mt-4",children:[e.jsx(c,{htmlFor:"match-points-formula",children:s("options.matchPointsFormula")}),e.jsxs("select",{id:"match-points-formula",value:a.matchPointsFormula||"proportional",onChange:t=>r({...a,matchPointsFormula:t.target.value}),className:"mt-2 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"proportional",children:s("options.matchPointsFormulaProportional")}),e.jsx("option",{value:"winner-only",children:s("options.matchPointsFormulaWinnerOnly")})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("options.tooltips.matchPointsFormula")})]})]}),d==="free-for-all"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"participants-per-match",children:s("options.participantsPerMatch")}),e.jsx(h,{id:"participants-per-match",type:"number",min:"2",value:a.participantsPerMatch||a.playersPerMatch||4,onChange:t=>r({...a,participantsPerMatch:parseInt(t.target.value)}),className:"mt-2"})]}),a.matchType==="multi-player"&&e.jsxs("div",{className:"mt-4",children:[e.jsx(c,{htmlFor:"advancement-rule",children:s("options.advancementRule")}),e.jsxs("select",{id:"advancement-rule",value:a.advancementRule||"winner-only",onChange:t=>r({...a,advancementRule:t.target.value,advancementCount:t.target.value==="top-n"?2:void 0}),className:"mt-2 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"winner-only",children:s("options.advancementRuleWinnerOnly")}),e.jsx("option",{value:"top-n",children:s("options.advancementRuleTopN")})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("options.tooltips.advancementRuleTopN")})]}),a.matchType==="multi-player"&&a.advancementRule==="top-n"&&e.jsxs("div",{className:"mt-4",children:[e.jsx(c,{htmlFor:"advancement-count",children:s("options.advancementCount")}),e.jsx(h,{id:"advancement-count",type:"number",min:"2",max:a.participantsPerMatch||4,value:a.advancementCount||2,onChange:t=>r({...a,advancementCount:parseInt(t.target.value)}),className:"mt-2"})]})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(u,{variant:"outline",onClick:()=>b("type"),children:s("common.back")}),e.jsx(u,{onClick:D,children:s("common.next")})]})]}),j==="participants"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:s("create.addParticipants")}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"participant-name",children:s("create.participantName")}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(h,{id:"participant-name",type:"text",value:N,onChange:t=>{M(t.target.value),P.length>0&&p([])},onKeyPress:t=>{t.key==="Enter"&&(t.preventDefault(),T())},placeholder:s("create.participantNamePlaceholder"),className:"flex-1"}),e.jsx(u,{onClick:T,children:s("common.add")})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:s("create.participantsList",{count:a.participantNames?.length||0})}),a.participantNames&&a.participantNames.length>0?e.jsx("ul",{className:"space-y-2",children:a.participantNames.map((t,n)=>e.jsxs("li",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-md",children:[e.jsx("span",{className:"text-sm text-gray-900",children:t}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>W(n),className:"h-6 w-6 text-red-600 hover:text-red-800 hover:bg-red-50",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},n))}):e.jsx("p",{className:"text-sm text-gray-500",children:s("create.noParticipants")})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(u,{variant:"outline",onClick:()=>b("options"),children:s("common.back")}),e.jsx(u,{onClick:A,disabled:(a.participantNames?.length||0)<2,className:"bg-green-600 hover:bg-green-700",children:s(f?"create.saveChanges":"create.createTournament")})]})]})]})})})}export{V as default};
